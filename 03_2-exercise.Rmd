# **Exercise on data preparation**

The example presented in this section uses data from three soil profiles from undisturbed forests in Suriname [@poels1987] collected with a soil auger: one Orthic Ferralsol (*Profile 35*, 8 horizons) and two Xanthic Ferralsols (*Profiles 36 and 37*, 9 horizons each). This data requires harmonization in coordinate systems, dates, soil properties, and laboratory methods before being included in the GloSIS database. For simplification, only analytical data for selected soil parameters have been included in this exercise.

## Filling out the plot data sheet

All soil profiles have been collected within the same project. The `project_name` column for all profiles is set to `LH/UvS_01`.

The `profile_code` attribute follows the names of the soil profiles in the original document.

`site_code` and `plot_code` inform about the location of the sample. In this case `site_code` has been set to the district (`Para`) and `site_code` to the protected area of `Kabo`, where all samples were collected.

Since the samples were collected with an auger, the `plot_type` attribute must be set to `borehole` The available options are `borehole` for auger sampling and `pit` if an open pit was excavated.

For each soil sampling point, the `n_layers` attribute correspond to the number of horizons/layers collected at that point. In this case, `n_layers` is equal to the number of horizons sampled by profile.

The `date` format in the original document follows the `*DD Month YYYY*` format (e.g., 27 May 1983). This format must be converted to `*YYYY-MM-DD*` (1983-05-27), which is the standard format accepted by the GloSIS database.

The original coordinates of the points were expressed in **degrees and minutes**, using a central point as a reference (5°15'N, 55°43'W) and including displacement information in meters. Additionally, the coordinate system (**EPSG**) was not defined. We estimated the coordinates for each soil sampling point, using the information provided, in relation to the **EPSG::4326** coordinate system (see Table \@ref(tab:soil-coordinates)).

No corrections were necessary for `altitude`. The `positional accuracy` was estimated at *1850 m*.   <br><br>


```{r soil-coordinates, echo=FALSE}
# Create a data frame for the table
soil_profiles <- data.frame(
  project_name = c("LH/UvS_01", "LH/UvS_01", "LH/UvS_01"),
  site_code = c("Para", "Para", "Para"),
  plot_code = c("Kabo", "Kabo", "Kabo"),
  profile_code = c("Profile35", "Profile36", "Profile37"),
  plot_type = c("Borehole", "Borehole", "Borehole"),
  n_layers = c(8,9,9),
  date = c("1983-05-27", "1978-08-10", "1983-06-02"),
  longitude = c(-55.7148, -55.7166, -55.7131),
  latitude = c(5.25, 5.25, 5.25),
  altitude = c(20, 27, 39),
  positional_accuracy = c(1850, 1850, 1850),
  extent = c("","",""),
  map_sheet_code = c("", "", "")
)

# Print the table in a nicely formatted way
kable(soil_profiles, caption = "Table 1: Harmonized data for the plot data sheet for the exercise data.")
```

<br>
The `extent` column refers to a surface plot. In this example, the samples are points, so no information on extent is applicable.

The columns `altitude`, `positional accuracy` and `map_sheet_code` are optional.


## Filling out the specimen data sheet

The `specimen data` sheet contains information for each soil sample collected at each soil sampling location. The number of rows must therefore be equal to the total number of horizons/layers at each sampling location (`n_layers`). In this example, the total number of rows in this sheet is 26.

Two different types of data are required in this sheet. First, the columns `profile_code`, `element_code`, `type`, `order_element`, `upper_depth`, `lower_depth`, and `specimen_code` serve as identifiers for samples, sample types, and soil depths. The remaining columns correspond to soil properties measured through laboratory analyses.

The `profile_code` column references the same attribute from the previous sheet and must contain repetitions corresponding to the number of horizons collected at each sampling location.

The `order_element` column is a sequential number that increases from top to bottom horizons, starting from 1.

The `element_code` is generated by combining the `profile_code` and `order_element` to create a unique identifier for each horizon.

The `type` attribute is set to `Horizon` for genetic soil horizons. If the sample is not collected based on pedogenetic criteria but is defined by specific boundaries, the option `Layer` is used.

The `upper_depth` and `lower_depth` columns specify the depth range (in cm) of each horizon or layer within the soil profile. Except for the top horizon, the `upper_depth` value of each horizon must match the `lower_depth` value of the preceding horizon within the same profile.

The `specimen_code` is an alphanumeric string that uniquely identifies each soil sample. In this case, the same value as `element_code` has been used for consistency.   <br><br>


```{r plotparameters1, echo=FALSE}

# Create a data frame for the table
soil_horizons <- data.frame(
  profile_code = c(rep("Profile35", 8), rep("Profile36", 9), rep("Profile37", 9)),
  element_code = c(
    "Profile35_1", "Profile35_2", "Profile35_3", "Profile35_4", "Profile35_5", "Profile35_6", "Profile35_7", "Profile35_8",
    "Profile36_1", "Profile36_2", "Profile36_3", "Profile36_4", "Profile36_5", "Profile36_6", "Profile36_7", "Profile36_8", "Profile36_9",
    "Profile37_1", "Profile37_2", "Profile37_3", "Profile37_4", "Profile37_5", "Profile37_6", "Profile37_7", "Profile37_8", "Profile37_9"
  ),
  type = rep("Horizon", 26),
  order_element = c(1:8, 1:9, 1:9),
  upper_depth = c(0, 4, 9, 24, 50, 66, 104, 134, 0, 3, 10, 27, 48, 63, 87, 102, 130, 0, 4, 15, 24, 41, 52, 87, 112, 143),
  lower_depth = c(4, 9, 24, 50, 66, 104, 134, 170, 3, 10, 27, 48, 63, 87, 102, 130, 180, 4, 15, 24, 41, 52, 87, 112, 143, 180),
  specimen_code = c(
    "Profile35_1", "Profile35_2", "Profile35_3", "Profile35_4", "Profile35_5", "Profile35_6", "Profile35_7", "Profile35_8",
    "Profile36_1", "Profile36_2", "Profile36_3", "Profile36_4", "Profile36_5", "Profile36_6", "Profile36_7", "Profile36_8", "Profile36_9",
    "Profile37_1", "Profile37_2", "Profile37_3", "Profile37_4", "Profile37_5", "Profile37_6", "Profile37_7", "Profile37_8", "Profile37_9"
  )
)

# Print the table in a nicely formatted way
kable(soil_horizons, caption = "Sample descriptors in the specimen data sheet for the exercise data.")
```

<br>
The parameters for soil properties must include, for each property, its measured value in the laboratory using the harmonized units of measurement defined in GloSIS, as specified in the `observation_phys_chem_id` column of the template. Any value reported in different units **MUST** be converted to the harmonized units before being entered into this sheet. Values that fall outside the predefined lower and upper thresholds in the database will be excluded, preventing full population of the database.


```{r plotparameters2, echo=FALSE}

# Create the soil properties dataframe
soil_lab <- data.frame(
  Sand = c(83.5, 76.2, 68.5, 63.8, 62.8, 64.2, 62.3, 58.1, 75.2, 75.6),
  Silt = c(13.6, 17.6, 17.9, 18.8, 14.2, 12.4, 12.5, 14.3, 21.7, 16.4),
  Clay = c(2.9, 6.3, 13.6, 17.6, 23.1, 23.6, 25.4, 27.8, 3.2, 8),
  C = c(11.7, 12, 8.2, 5.6, 2.5, 1.4, 0.7, 0.6, 15.2, 8.6),
  N = c(0.8, 0.9, 0.6, 0.4, 0.2, 0.3, 0.1, 0.1, 1.1, 0.8),
  pH_H2O = c(4, 3.7, 4.4, 4.8, 4.8, 4.8, 5, 5, 4, 4),
  pH_KCl = c(3.3, 3.4, 3.8, 4, 3.8, 4, 4, 4.1, 3.8, 3.6),
  CEC = c(26, 28.4, 23.2, 22.8, 14.4, 12.2, 10.8, 9.8, 34.8, 26.6),
  Ca = c(1.25, 0.4, 0.15, 0.15, 0.15, 0.15, 0, 0.15, 2.3, 0.3),
  Mg = c(1.15, 0.5, 0.25, 0.15, 0.1, 0.05, 0, 0, 0.5, 0.25),
  K = c(0.4, 0.3, 0.1, 0.1, 0, 0, 0.1, 0, 0.6, 0.3),
  Na = c(0.2, 0.5, 0.3, 0.2, 0.2, 0.1, 0, 0.1, 0.7, 0.3),
  Al = c(1.2654, 4.1292, 3.9294, 4.0959, 2.997, 2.5641, 2.2977, 2.2311, 2.3643, 3.663),
  ECEC = c(9.2, 15, 13, 13.2, 9.7, 8.2, 7, 7.1, 14, 12.7),
  K_total = c(0.0513, 0.0615, 0.0615, 0.0769, 0.0872, 0.0769, 0.1026, 0.0872, 0.1051, 0.1513),
  P_total = c(0.0032, 0.0049, 0.0054, 0.0047, 0.0052, 0.0049, 0.0037, 0.0037, 0.0054, 0.0060),
  P_Bray_I = c(0.0002, 0.0002, 0.0001, 0.0001, 0.0000, 0.0001, 0.0001, 0.0001, 0.0002, 0.0001),
  Bulk_Density = c(NA, 1.41, 1.28, 1.56, 1.6, 1.65, 1.69, 1.69, 1.38, 1.47),
  pF_2 = c(NA, 23.2, 22.4, 25.2, 26, 25.9, 27.1, 29.7, NA, 20.4)
)

# Render the table in R Markdown
kable(soil_lab, caption = "Analytical properties in the specimen data sheet for the exercise data.")
```


## Filling out the procedures data sheet

The first column in the `Procedures` sheet **MUST** contain all soil analytical properties included in the `specimen data` and in the same order of entrance. The proper GloSIS names for soil properties, analysis methods and units **MUST** be defined for each soil property using the data provided in the `observation_phys_chem_id` sheet.

The first column in the `Procedures` sheet **MUST** include all soil analytical properties listed in the specimen data sheet, maintaining the same order of entry. The correct GloSIS names for soil properties, analysis methods, and units **MUST** be assigned to each soil property using the data provided in the observation_phys_chem_id sheet. Properties that are not listed in the `observation_phys_chem_id` sheet are not allowed.

```{r procedures, echo=FALSE}
# Create the soil properties mapping dataframe
soil_property_mapping <- data.frame(
  soil_property = c("Sand (%)", "Silt (%)", "Clay (%)", "C (%)", "N (%)", "pH-H₂O", "pH-KCl", 
                    "CEC (me/100g)", "Ca (me/100g)", "Mg (me/100g)", "K (me/100g)", "Na (me/100g)", 
                    "Al (me/100g)", "ECEC (me/100g)", "K total (ppm)", "P total (ppm)", 
                    "P-Bray I (ppm)", "Bulk Density (kg/l)", "pF 2 (%)"),
  property_phys_chem_id = c("Sand texture fraction", "Silt texture fraction", "Clay texture fraction", 
                            "Carbon (C) - organic", "Nitrogen (N) - total", "pH - Hydrogen potential", 
                            "pHProperty", "cationExchangeCapacitySoil", "Calcium (Ca++) - exchangeable", 
                            "Magnesium (Mg++) - exchangeable", "Potassium (K+) - exchangeable", 
                            "Sodium (Na+) - exchangeable", "Aluminium (Al+++) - exchangeable", 
                            "effectiveCecProperty", "Potassium (K) - total", "Phosphorus (P) - total", 
                            "Phosphorus (P) - extractable", "bulkDensityFineEarthProperty", 
                            "Available water capacity - volumetric (FC to WP)"),
  procedure_phys_chem_id = c("SaSiCl_2-20-2000u-disp-pipette", "SaSiCl_2-20-2000u-disp-pipette", 
                             "SaSiCl_2-20-2000u-disp-pipette", "OrgC_wc-cro3-walkleyblack", 
                             "TotalN_kjeldahl", "pHH2O", "pHKCl", "CEC_ph7-nh4oac", 
                             "ExchBases_ph7-nh4oac", "ExchBases_ph7-nh4oac", "ExchBases_ph7-nh4oac", 
                             "ExchBases_ph7-nh4oac", "ExchBases_ph7-nh4oac", "EffCEC_calcul-ba", 
                             "Total_h2so4", "Total_h2so4", "Extr_hcl-nh4f-bray1", "BlkDensF_fe-unkn", 
                             "PAWHC_calcul-fc100wp"),
  unit_of_measure_id = c("%", "%", "%", "g/kg", "g/kg", "pH", "pH", "cmol/kg", "cmol/kg", "cmol/kg", 
                         "cmol/kg", "cmol/kg", "cmol/kg", "cmol/kg", "cmol/kg", "%", "%", "kg/dm3", 
                         "m3/100 m3")
)

# Render the table in R Markdown
kable(soil_property_mapping, caption = "Soil Property Mapping Table for the exercise data")
```

  
  This table ensures that all soil properties are named according to the GloSIS standard and that he corresponding methods and units are correctly defined


## *Special Considerations*:
- Any soil property value that is missing **MUST** be left empty in the `.xlsx` template. Entries such as `NA`, `nodata`, `-`, etc., are not permitted.  
- Ensure that all numeric values are correctly formatted as numbers in the template. Any alphanumeric entry in a numeric column will cause the entire column to be treated as alphanumeric.  
- Special characters such as `*`, `/`, `?`, etc., are not allowed. This includes the `<` symbol, commonly used for values below the detection limit of analytical equipment. In such cases, either leave the value empty or replace it by dividing the detection limit by a factor of two.  
- All soil properties that are not listed in the `observation_phys_chem_id` **MUST** be removed from the analysis. They cannot be included in either the `specimen data` or the `Procedures` sheets. If they are left in these sheets, the database will not be correctly populated.

